<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gerador de Certid√µes | Douglas Vilar Advogados</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">

<!-- Firebase -->
<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
  import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

  // =====================================================
  // SUBSTITUA AQUI COM SUAS CREDENCIAIS DO FIREBASE
  // =====================================================
  const firebaseConfig = {
    apiKey: 'SUA_API_KEY',
    authDomain: 'SEU_PROJETO.firebaseapp.com',
    projectId: 'SEU_PROJETO',
    storageBucket: 'SEU_PROJETO.appspot.com',
    messagingSenderId: 'SEU_SENDER_ID',
    appId: 'SEU_APP_ID'
  };
  // =====================================================

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  window._fbAuth = auth;
  window._fbProvider = provider;
  window._fbSignInWithPopup = signInWithPopup;
  window._fbSignOut = signOut;
  window._fbOnAuthStateChanged = onAuthStateChanged;

  onAuthStateChanged(auth, (user) => {
    if (user) {
      window._currentUser = user;
      window.dispatchEvent(new CustomEvent('userLoggedIn', { detail: user }));
    } else {
      window._currentUser = null;
      window.dispatchEvent(new CustomEvent('userLoggedOut'));
    }
  });
</script>

<style>
/* ===== RESET & BASE ===== */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --navy: #0b3b5c;
  --navy-dark: #072d47;
  --navy-mid: #1a4f73;
  --navy-light: #1e6091;
  --gold: #c4a54d;
  --gold-light: #d4bc7a;
  --gold-pale: #f5edd8;
  --white: #ffffff;
  --off-white: #f9f7f3;
  --gray-100: #f0ede8;
  --gray-200: #e2ddd6;
  --gray-400: #9e9890;
  --gray-600: #6b6660;
  --text: #1a1512;
  --shadow: 0 4px 24px rgba(11,59,92,0.12);
  --shadow-lg: 0 12px 48px rgba(11,59,92,0.18);
  --radius: 12px;
  --radius-lg: 20px;
  --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
}

html { scroll-behavior: smooth; }

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--off-white);
  color: var(--text);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

h1, h2, h3, h4 { font-family: 'Playfair Display', serif; }

/* ===== LOADER ===== */
#global-loader {
  position: fixed; inset: 0; z-index: 9999;
  background: var(--navy);
  display: flex; align-items: center; justify-content: center;
  flex-direction: column; gap: 20px;
  transition: opacity 0.4s ease;
}
#global-loader .logo-text { color: var(--white); font-family: 'Playfair Display', serif; font-size: 1.8rem; }
#global-loader .logo-sub { color: var(--gold); font-size: 0.85rem; letter-spacing: 3px; text-transform: uppercase; }
.loader-ring {
  width: 48px; height: 48px;
  border: 3px solid rgba(196,165,77,0.2);
  border-top-color: var(--gold);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* ===== HEADER ===== */
#app-header {
  background: var(--navy);
  padding: 0 24px;
  position: sticky; top: 0; z-index: 100;
  box-shadow: 0 2px 20px rgba(0,0,0,0.25);
  display: none;
}
.header-inner {
  max-width: 1400px; margin: 0 auto;
  display: flex; align-items: center; justify-content: space-between;
  height: 68px; gap: 16px;
}
.header-brand {
  display: flex; align-items: center; gap: 14px;
  flex-shrink: 0;
}
.brand-icon {
  width: 40px; height: 40px;
  background: linear-gradient(135deg, var(--gold), #a8893a);
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-family: 'Playfair Display', serif;
  color: var(--navy); font-weight: 700; font-size: 1.1rem;
}
.brand-name { color: var(--white); font-family: 'Playfair Display', serif; font-size: 1.05rem; line-height: 1.2; }
.brand-oab { color: var(--gold-light); font-size: 0.72rem; font-family: 'DM Sans', sans-serif; letter-spacing: 1px; }
.header-center { flex: 1; text-align: center; }
.header-center span { color: var(--gray-400); font-size: 0.8rem; letter-spacing: 2px; text-transform: uppercase; }
.header-user {
  display: flex; align-items: center; gap: 10px; flex-shrink: 0;
}
.user-avatar {
  width: 34px; height: 34px; border-radius: 50%;
  border: 2px solid var(--gold);
  object-fit: cover;
}
.user-name { color: var(--gold-light); font-size: 0.82rem; max-width: 120px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.btn-logout {
  background: transparent; border: 1px solid rgba(196,165,77,0.3);
  color: var(--gold-light); padding: 6px 14px; border-radius: 6px;
  font-size: 0.78rem; cursor: pointer; transition: var(--transition);
  font-family: 'DM Sans', sans-serif;
}
.btn-logout:hover { background: rgba(196,165,77,0.1); border-color: var(--gold); }

/* ===== SCREENS ===== */
.screen { display: none; flex: 1; }
.screen.active { display: flex; flex-direction: column; }

/* ===== WELCOME SCREEN ===== */
#screen-welcome {
  background: linear-gradient(160deg, var(--navy-dark) 0%, var(--navy) 50%, var(--navy-mid) 100%);
  align-items: center; justify-content: center;
  min-height: 100vh; padding: 40px 20px;
  position: relative; overflow: hidden;
}
#screen-welcome::before {
  content: '';
  position: absolute; inset: 0;
  background-image: 
    radial-gradient(circle at 20% 80%, rgba(196,165,77,0.08) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(196,165,77,0.06) 0%, transparent 40%),
    repeating-linear-gradient(
      0deg, transparent, transparent 59px,
      rgba(196,165,77,0.03) 60px
    ),
    repeating-linear-gradient(
      90deg, transparent, transparent 59px,
      rgba(196,165,77,0.03) 60px
    );
  pointer-events: none;
}
.welcome-card {
  background: rgba(255,255,255,0.04);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(196,165,77,0.2);
  border-radius: 28px;
  padding: 60px 64px;
  max-width: 540px; width: 100%;
  text-align: center;
  box-shadow: 0 32px 80px rgba(0,0,0,0.35), inset 0 1px 0 rgba(196,165,77,0.15);
  position: relative; z-index: 1;
  animation: fadeUp 0.6s ease forwards;
}
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}
.welcome-ornament {
  display: flex; align-items: center; justify-content: center;
  gap: 14px; margin-bottom: 28px;
}
.ornament-line { flex: 1; height: 1px; background: linear-gradient(90deg, transparent, var(--gold)); }
.ornament-line.right { background: linear-gradient(90deg, var(--gold), transparent); }
.ornament-icon {
  width: 52px; height: 52px;
  background: linear-gradient(135deg, var(--gold), #9a7a2a);
  border-radius: 14px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.4rem; box-shadow: 0 8px 24px rgba(196,165,77,0.3);
}
.welcome-title {
  color: var(--white); font-size: 2rem; line-height: 1.2;
  margin-bottom: 8px; font-weight: 600;
}
.welcome-subtitle {
  color: var(--gold); font-size: 0.82rem; letter-spacing: 2.5px;
  text-transform: uppercase; margin-bottom: 20px; font-family: 'DM Sans', sans-serif;
}
.welcome-divider {
  width: 48px; height: 2px;
  background: linear-gradient(90deg, transparent, var(--gold), transparent);
  margin: 0 auto 24px;
}
.welcome-message { color: rgba(255,255,255,0.65); font-size: 0.92rem; line-height: 1.7; margin-bottom: 36px; }
.btn-google {
  display: flex; align-items: center; justify-content: center; gap: 12px;
  background: var(--white); color: #3c4043;
  border: none; border-radius: 12px;
  padding: 14px 28px; width: 100%;
  font-size: 0.95rem; font-weight: 500; cursor: pointer;
  font-family: 'DM Sans', sans-serif;
  box-shadow: 0 4px 16px rgba(0,0,0,0.2);
  transition: var(--transition);
}
.btn-google:hover {
  background: #f8f9fa; box-shadow: 0 8px 28px rgba(0,0,0,0.3);
  transform: translateY(-1px);
}
.google-icon { width: 20px; height: 20px; flex-shrink: 0; }
.welcome-features {
  display: flex; gap: 20px; margin-top: 28px; justify-content: center;
}
.feat-item {
  display: flex; flex-direction: column; align-items: center; gap: 6px;
  color: rgba(255,255,255,0.5); font-size: 0.72rem; text-transform: uppercase; letter-spacing: 1px;
}
.feat-icon { font-size: 1.4rem; }

/* ===== REGISTER MODAL ===== */
#screen-register {
  position: fixed; inset: 0; z-index: 500;
  background: rgba(7,45,71,0.85); backdrop-filter: blur(6px);
  display: none; align-items: center; justify-content: center; padding: 20px;
}
#screen-register.active { display: flex; }
.register-card {
  background: var(--white); border-radius: var(--radius-lg);
  padding: 44px 48px; max-width: 520px; width: 100%;
  box-shadow: var(--shadow-lg);
  animation: fadeUp 0.3s ease forwards;
}
.register-header { text-align: center; margin-bottom: 32px; }
.register-header h2 { color: var(--navy); font-size: 1.6rem; margin-bottom: 8px; }
.register-header p { color: var(--gray-600); font-size: 0.88rem; line-height: 1.6; }
.register-badge {
  display: inline-flex; align-items: center; gap: 6px;
  background: var(--gold-pale); color: var(--navy); border-radius: 20px;
  padding: 4px 12px; font-size: 0.75rem; margin-bottom: 12px;
  font-weight: 500;
}
.form-group { margin-bottom: 18px; }
.form-group label { display: block; font-size: 0.82rem; font-weight: 500; color: var(--navy); margin-bottom: 6px; }
.form-group input {
  width: 100%; padding: 11px 14px;
  border: 1.5px solid var(--gray-200); border-radius: 8px;
  font-size: 0.92rem; font-family: 'DM Sans', sans-serif;
  transition: var(--transition); color: var(--text); background: var(--white);
}
.form-group input:focus { outline: none; border-color: var(--navy); box-shadow: 0 0 0 3px rgba(11,59,92,0.08); }
.form-group input[readonly] { background: var(--gray-100); color: var(--gray-600); }
.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
.btn-primary {
  background: linear-gradient(135deg, var(--navy), var(--navy-mid));
  color: var(--white); border: none; border-radius: 10px;
  padding: 13px 28px; width: 100%; font-size: 0.95rem; font-weight: 500;
  cursor: pointer; font-family: 'DM Sans', sans-serif;
  transition: var(--transition); margin-top: 6px;
  box-shadow: 0 4px 16px rgba(11,59,92,0.3);
}
.btn-primary:hover { transform: translateY(-1px); box-shadow: 0 8px 24px rgba(11,59,92,0.4); }
.optional-tag { color: var(--gray-400); font-weight: 400; font-size: 0.75rem; }

/* ===== MAIN APP ===== */
#screen-app { background: var(--off-white); }
.app-body { max-width: 1400px; margin: 0 auto; padding: 28px 24px 60px; }

/* ===== SIDEBAR FORM ===== */
.app-layout { display: grid; grid-template-columns: 340px 1fr; gap: 28px; align-items: start; }

.sidebar {
  position: sticky; top: 96px;
  background: var(--white); border-radius: var(--radius-lg);
  box-shadow: var(--shadow); overflow: hidden;
}
.sidebar-header {
  background: linear-gradient(135deg, var(--navy), var(--navy-mid));
  padding: 20px 22px;
  color: var(--white);
}
.sidebar-header h3 { font-size: 1.1rem; margin-bottom: 4px; }
.sidebar-header p { font-size: 0.78rem; color: rgba(255,255,255,0.6); }
.sidebar-body { padding: 20px 22px; }

.s-label { font-size: 0.78rem; font-weight: 600; color: var(--gray-600); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
.s-input {
  width: 100%; padding: 10px 13px;
  border: 1.5px solid var(--gray-200); border-radius: 8px;
  font-size: 0.9rem; font-family: 'DM Sans', sans-serif;
  transition: var(--transition); color: var(--text); background: var(--white);
  margin-bottom: 14px;
}
.s-input:focus { outline: none; border-color: var(--navy); box-shadow: 0 0 0 3px rgba(11,59,92,0.08); }
.s-select {
  width: 100%; padding: 10px 13px;
  border: 1.5px solid var(--gray-200); border-radius: 8px;
  font-size: 0.9rem; font-family: 'DM Sans', sans-serif;
  background: var(--white); color: var(--text);
  cursor: pointer; transition: var(--transition); margin-bottom: 14px;
}
.s-select:focus { outline: none; border-color: var(--navy); }

/* Vendedores m√∫ltiplos */
.vendedores-list { display: flex; flex-direction: column; gap: 10px; margin-bottom: 10px; }
.vendedor-item {
  background: var(--gray-100); border-radius: 10px; padding: 12px 14px;
  border: 1.5px solid var(--gray-200);
  position: relative;
}
.vendedor-item .vi-name { font-weight: 500; font-size: 0.88rem; color: var(--navy); }
.vendedor-item .vi-cpf { font-size: 0.78rem; color: var(--gray-600); }
.vi-remove {
  position: absolute; top: 8px; right: 8px;
  background: none; border: none; color: var(--gray-400); cursor: pointer; font-size: 1rem; padding: 2px;
  transition: var(--transition);
}
.vi-remove:hover { color: #c0392b; }
.btn-add-vendedor {
  display: flex; align-items: center; gap: 8px; width: 100%;
  background: transparent; border: 1.5px dashed var(--gold);
  color: var(--gold); border-radius: 8px; padding: 9px 14px;
  font-size: 0.85rem; cursor: pointer; transition: var(--transition);
  font-family: 'DM Sans', sans-serif; font-weight: 500; margin-bottom: 16px;
}
.btn-add-vendedor:hover { background: var(--gold-pale); }

/* Vendedor form inline */
.vendedor-form-inline { background: var(--gray-100); border-radius: 10px; padding: 14px; margin-bottom: 10px; border: 1.5px solid var(--gold-light); }
.vendedor-form-inline .s-input { margin-bottom: 8px; }
.vf-actions { display: flex; gap: 8px; }
.btn-vf-ok {
  flex: 1; background: var(--navy); color: var(--white); border: none;
  border-radius: 7px; padding: 8px; font-size: 0.82rem; cursor: pointer;
  font-family: 'DM Sans', sans-serif;
}
.btn-vf-cancel {
  background: transparent; border: 1px solid var(--gray-200); border-radius: 7px;
  padding: 8px 12px; font-size: 0.82rem; cursor: pointer;
  font-family: 'DM Sans', sans-serif; color: var(--gray-600);
}

/* Progress bar */
.progress-card {
  background: var(--white); border-radius: var(--radius);
  padding: 18px 20px; margin-bottom: 20px;
  box-shadow: var(--shadow);
}
.progress-stats {
  display: grid; grid-template-columns: repeat(3, 1fr);
  gap: 10px; margin-bottom: 14px;
}
.prog-stat { text-align: center; }
.prog-stat .num {
  font-size: 1.8rem; font-weight: 700; font-family: 'Playfair Display', serif;
  line-height: 1;
}
.prog-stat .lbl { font-size: 0.7rem; color: var(--gray-600); text-transform: uppercase; letter-spacing: 0.5px; margin-top: 2px; }
.num.total { color: var(--navy); }
.num.opened { color: #2e7d32; }
.num.pending { color: #e65100; }
.progress-bar-wrap { height: 8px; background: var(--gray-200); border-radius: 4px; overflow: hidden; }
.progress-bar-fill {
  height: 100%; border-radius: 4px;
  background: linear-gradient(90deg, var(--navy), var(--navy-light));
  transition: width 0.5s ease;
}

/* ===== MAIN CONTENT ===== */
.main-content {}
.page-title {
  margin-bottom: 24px;
}
.page-title h2 { color: var(--navy); font-size: 1.5rem; }
.page-title p { color: var(--gray-600); font-size: 0.85rem; margin-top: 4px; }

.btn-download {
  display: inline-flex; align-items: center; gap: 8px;
  background: linear-gradient(135deg, var(--gold), #a8893a);
  color: var(--white); border: none; border-radius: 10px;
  padding: 11px 22px; font-size: 0.88rem; font-weight: 500;
  cursor: pointer; transition: var(--transition);
  font-family: 'DM Sans', sans-serif;
  box-shadow: 0 4px 14px rgba(196,165,77,0.3);
  text-decoration: none;
}
.btn-download:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(196,165,77,0.4); }

.pt-actions { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px; margin-bottom: 24px; }

/* Category section */
.cat-section { margin-bottom: 32px; }
.cat-header {
  display: flex; align-items: center; gap: 12px; margin-bottom: 16px;
  padding-bottom: 10px;
  border-bottom: 2px solid var(--gray-200);
}
.cat-badge {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 5px 14px; border-radius: 20px; font-size: 0.78rem;
  font-weight: 600; letter-spacing: 0.5px; text-transform: uppercase;
}
.cat-badge.vendedor { background: #e8f4fc; color: var(--navy); }
.cat-badge.imovel { background: #fff8e1; color: #7c5a00; }
.cat-badge.comprador { background: #e8f5e9; color: #1b5e20; }
.cat-badge.complementar { background: #fce4ec; color: #880e4f; }
.cat-count { font-size: 0.8rem; color: var(--gray-400); margin-left: auto; }

.cards-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 16px;
}

/* Card */
.cert-card {
  background: var(--white); border-radius: var(--radius);
  box-shadow: var(--shadow); overflow: hidden;
  transition: var(--transition); border: 2px solid transparent;
  position: relative;
}
.cert-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-lg); border-color: var(--gray-200); }
.cert-card.opened { border-color: rgba(46,125,50,0.3); background: #f1f8f2; }

.card-stripe {
  height: 4px;
}
.cat-vendedor .card-stripe { background: linear-gradient(90deg, var(--navy), var(--navy-light)); }
.cat-imovel .card-stripe { background: linear-gradient(90deg, #c49a00, #f5c400); }
.cat-comprador .card-stripe { background: linear-gradient(90deg, #2e7d32, #66bb6a); }
.cat-complementar .card-stripe { background: linear-gradient(90deg, #880e4f, #e91e63); }

.card-body { padding: 16px 18px; }
.card-num {
  font-size: 0.7rem; font-weight: 700; color: var(--gray-400);
  text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;
}
.card-name { font-size: 0.97rem; font-weight: 500; color: var(--navy); margin-bottom: 6px; line-height: 1.3; }
.card-url { font-size: 0.72rem; color: var(--gray-400); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 14px; }

.card-footer {
  display: flex; align-items: center; gap: 8px; padding: 12px 18px;
  background: var(--gray-100); border-top: 1px solid var(--gray-200);
}
.btn-open {
  flex: 1; display: flex; align-items: center; justify-content: center; gap: 6px;
  background: linear-gradient(135deg, var(--navy), var(--navy-mid));
  color: var(--white); border: none; border-radius: 7px;
  padding: 9px 14px; font-size: 0.82rem; font-weight: 500; cursor: pointer;
  font-family: 'DM Sans', sans-serif; transition: var(--transition);
}
.btn-open:hover { background: linear-gradient(135deg, var(--navy-dark), var(--navy)); }
.btn-mark {
  background: transparent; border: 1.5px solid var(--gray-200);
  color: var(--gray-600); border-radius: 7px; padding: 8px 10px;
  font-size: 0.78rem; cursor: pointer; transition: var(--transition);
  font-family: 'DM Sans', sans-serif; white-space: nowrap;
}
.cert-card.opened .btn-mark { background: #e8f5e9; border-color: #a5d6a7; color: #2e7d32; }
.btn-mark:hover { border-color: var(--navy); color: var(--navy); }

.opened-badge {
  position: absolute; top: 14px; right: 14px;
  background: #2e7d32; color: var(--white);
  font-size: 0.68rem; padding: 2px 8px; border-radius: 10px; font-weight: 600;
}

/* ===== TOAST ===== */
#toast-container {
  position: fixed; bottom: 28px; right: 28px; z-index: 9998;
  display: flex; flex-direction: column; gap: 10px; pointer-events: none;
}
.toast {
  background: var(--navy); color: var(--white);
  padding: 12px 20px; border-radius: 10px;
  font-size: 0.88rem; display: flex; align-items: center; gap: 10px;
  box-shadow: var(--shadow-lg);
  animation: slideIn 0.3s ease forwards;
  border-left: 4px solid var(--gold);
  pointer-events: auto;
}
@keyframes slideIn {
  from { opacity: 0; transform: translateX(30px); }
  to { opacity: 1; transform: translateX(0); }
}
.toast.fade-out { animation: slideOut 0.3s ease forwards; }
@keyframes slideOut {
  to { opacity: 0; transform: translateX(30px); }
}

/* ===== FOOTER ===== */
footer {
  background: var(--navy-dark);
  color: rgba(255,255,255,0.4);
  text-align: center; padding: 20px;
  font-size: 0.78rem; letter-spacing: 0.5px;
  display: none;
}
footer.show { display: block; }
footer a { color: var(--gold-light); text-decoration: none; }

/* ===== RESPONSIVE ===== */
@media (max-width: 900px) {
  .app-layout { grid-template-columns: 1fr; }
  .sidebar { position: static; }
  .welcome-card { padding: 40px 28px; }
}
@media (max-width: 560px) {
  .welcome-card { padding: 32px 20px; }
  .welcome-features { flex-direction: column; align-items: center; }
  .cards-grid { grid-template-columns: 1fr; }
  .register-card { padding: 32px 24px; }
  .form-row { grid-template-columns: 1fr; }
  .progress-stats { grid-template-columns: repeat(3, 1fr); }
}
</style>
</head>
<body>

<!-- Global Loader -->
<div id="global-loader">
  <div class="logo-text">Douglas Vilar</div>
  <div class="logo-sub">Advogados Associados</div>
  <div class="loader-ring"></div>
</div>

<!-- Toast Container -->
<div id="toast-container"></div>

<!-- ===== HEADER ===== -->
<header id="app-header">
  <div class="header-inner">
    <div class="header-brand">
      <div class="brand-icon">DV</div>
      <div>
        <div class="brand-name">Douglas Vilar</div>
        <div class="brand-oab">OAB/PR 47.278 ¬∑ Advocacia Imobili√°ria</div>
      </div>
    </div>
    <div class="header-center">
      <span>Gerador de Certid√µes Imobili√°rias</span>
    </div>
    <div class="header-user">
      <img id="header-avatar" class="user-avatar" src="" alt="Avatar">
      <span id="header-name" class="user-name"></span>
      <button class="btn-logout" onclick="doLogout()">Sair</button>
    </div>
  </div>
</header>

<!-- ===== WELCOME SCREEN ===== -->
<main id="screen-welcome" class="screen active">
  <div class="welcome-card">
    <div class="welcome-ornament">
      <div class="ornament-line"></div>
      <div class="ornament-icon">‚öñÔ∏è</div>
      <div class="ornament-line right"></div>
    </div>
    <div class="welcome-subtitle">Douglas Vilar Advogados Associados</div>
    <h1 class="welcome-title">Bem-vindo ao Gerador de Certid√µes</h1>
    <div class="welcome-divider"></div>
    <p class="welcome-message">
      Plataforma exclusiva para gera√ß√£o e controle de certid√µes imobili√°rias em transa√ß√µes de compra e venda. 
      Para acessar, fa√ßa login com sua conta Google.
    </p>
    <button class="btn-google" id="btn-login-google">
      <svg class="google-icon" viewBox="0 0 48 48">
        <path fill="#EA4335" d="M24 9.5c3.5 0 6.6 1.2 9 3.2l6.7-6.7C35.5 2.2 30.1 0 24 0 14.6 0 6.6 5.4 2.6 13.3l7.8 6C12.3 13.2 17.7 9.5 24 9.5z"/>
        <path fill="#4285F4" d="M46.1 24.5c0-1.6-.1-3.1-.4-4.5H24v8.5h12.4c-.5 2.8-2.1 5.2-4.5 6.8l7 5.4c4.1-3.8 6.5-9.4 6.5-16.2z"/>
        <path fill="#FBBC05" d="M10.4 28.6A14.6 14.6 0 0 1 9.5 24c0-1.6.3-3.2.8-4.6l-7.8-6A23.9 23.9 0 0 0 0 24c0 3.9.9 7.6 2.6 10.9l7.8-6.3z"/>
        <path fill="#34A853" d="M24 48c6.1 0 11.2-2 14.9-5.4l-7-5.4a14.9 14.9 0 0 1-22.3-8.4l-7.8 6C6.6 42.6 14.6 48 24 48z"/>
      </svg>
      Entrar com Google
    </button>
    <div class="welcome-features">
      <div class="feat-item"><span class="feat-icon">üè†</span>Certid√µes de Im√≥vel</div>
      <div class="feat-item"><span class="feat-icon">üìã</span>15 √ìrg√£os</div>
      <div class="feat-item"><span class="feat-icon">üìä</span>Relat√≥rios</div>
    </div>
  </div>
</main>

<!-- ===== REGISTER MODAL ===== -->
<div id="screen-register">
  <div class="register-card">
    <div class="register-header">
      <div class="register-badge">‚ú® Apenas uma vez</div>
      <h2>Complete seu Cadastro</h2>
      <p>Para come√ßar, preencha seus dados complementares. Isso s√≥ ser√° solicitado uma √∫nica vez.</p>
    </div>
    <div class="form-group">
      <label>Nome Completo *</label>
      <input type="text" id="reg-nome" placeholder="Seu nome completo">
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>CPF *</label>
        <input type="text" id="reg-cpf" placeholder="000.000.000-00" maxlength="14">
      </div>
      <div class="form-group">
        <label>CNPJ <span class="optional-tag">(opcional)</span></label>
        <input type="text" id="reg-cnpj" placeholder="00.000.000/0000-00" maxlength="18">
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>Instagram</label>
        <input type="text" id="reg-instagram" placeholder="@usuario">
      </div>
      <div class="form-group">
        <label>E-mail</label>
        <input type="email" id="reg-email" readonly>
      </div>
    </div>
    <button class="btn-primary" onclick="submitRegister()">‚úì Salvar e Acessar a Plataforma</button>
  </div>
</div>

<!-- ===== MAIN APP ===== -->
<main id="screen-app" class="screen">
  <div class="app-body">
    <div class="app-layout">

      <!-- SIDEBAR -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <h3>üè° Dados da Transa√ß√£o</h3>
          <p>Preencha para personalizar as certid√µes</p>
        </div>
        <div class="sidebar-body">

          <div class="s-label">Estado</div>
          <select class="s-select" id="sel-estado" onchange="updateCidade()">
            <option value="">Selecione o estado‚Ä¶</option>
          </select>

          <div class="s-label">Cidade</div>
          <select class="s-select" id="sel-cidade">
            <option value="">Selecione a cidade‚Ä¶</option>
          </select>

          <div class="s-label" style="margin-top:6px">Comprador</div>
          <input class="s-input" type="text" id="inp-comprador-nome" placeholder="Nome do comprador">
          <input class="s-input" type="text" id="inp-comprador-cpf" placeholder="CPF do comprador" maxlength="14" oninput="maskCPF(this)">

          <div class="s-label" style="margin-top:4px">Vendedores</div>
          <div class="vendedores-list" id="vendedores-list"></div>
          
          <div id="vendedor-form-inline" style="display:none" class="vendedor-form-inline">
            <input class="s-input" type="text" id="vf-nome" placeholder="Nome do vendedor">
            <input class="s-input" type="text" id="vf-cpf" placeholder="CPF" maxlength="14" oninput="maskCPF(this)">
            <div class="vf-actions">
              <button class="btn-vf-ok" onclick="confirmAddVendedor()">Adicionar</button>
              <button class="btn-vf-cancel" onclick="hideVendedorForm()">Cancelar</button>
            </div>
          </div>

          <button class="btn-add-vendedor" onclick="showVendedorForm()" id="btn-show-vf">
            <span>Ôºã</span> Adicionar Vendedor
          </button>

          <!-- Progress -->
          <div class="progress-card" style="margin:0 -2px">
            <div class="progress-stats">
              <div class="prog-stat"><div class="num total" id="cnt-total">15</div><div class="lbl">Total</div></div>
              <div class="prog-stat"><div class="num opened" id="cnt-opened">0</div><div class="lbl">Abertas</div></div>
              <div class="prog-stat"><div class="num pending" id="cnt-pending">15</div><div class="lbl">Pendentes</div></div>
            </div>
            <div class="progress-bar-wrap">
              <div class="progress-bar-fill" id="progress-fill" style="width:0%"></div>
            </div>
          </div>

        </div>
      </aside>

      <!-- MAIN CONTENT -->
      <div class="main-content">
        <div class="pt-actions">
          <div class="page-title">
            <h2>Certid√µes Imobili√°rias</h2>
            <p id="transacao-label">Configure os dados na barra lateral para personalizar</p>
          </div>
          <button class="btn-download" onclick="downloadReport()">
            üì• Baixar Relat√≥rio
          </button>
        </div>

        <!-- CARDS por categoria -->
        <div id="cards-container"></div>
      </div>

    </div>
  </div>
</main>

<!-- FOOTER -->
<footer id="app-footer">
  &copy; 2026 Douglas Vilar Sociedade de Advogados &nbsp;¬∑&nbsp; OAB/PR 47.278 &nbsp;¬∑&nbsp;
  <a href="https://douglasvilar.com.br" target="_blank">douglasvilar.com.br</a>
</footer>

<!-- ===== JS ===== -->
<script>
// ======================================================
// CERT DB ‚Äî mapeamento TJ, TRF, TRT por estado
// ======================================================
const CERT_DB = {
  estados: [
    {uf:'AC',nome:'Acre',tj:'TJAC',trf:'TRF-1',trt:'TRT-14',cidades:['Rio Branco','Cruzeiro do Sul','Sena Madureira','Tarauac√°']},
    {uf:'AL',nome:'Alagoas',tj:'TJAL',trf:'TRF-5',trt:'TRT-19',cidades:['Macei√≥','Arapiraca','Rio Largo','Palmeira dos √çndios']},
    {uf:'AP',nome:'Amap√°',tj:'TJAP',trf:'TRF-1',trt:'TRT-8',cidades:['Macap√°','Santana','Laranjal do Jari']},
    {uf:'AM',nome:'Amazonas',tj:'TJAM',trf:'TRF-1',trt:'TRT-11',cidades:['Manaus','Parintins','Itacoatiara','Manacapuru']},
    {uf:'BA',nome:'Bahia',tj:'TJBA',trf:'TRF-1',trt:'TRT-5',cidades:['Salvador','Feira de Santana','Vit√≥ria da Conquista','Cama√ßari','Itabuna']},
    {uf:'CE',nome:'Cear√°',tj:'TJCE',trf:'TRF-5',trt:'TRT-7',cidades:['Fortaleza','Caucaia','Juazeiro do Norte','Maracana√∫','Sobral']},
    {uf:'DF',nome:'Distrito Federal',tj:'TJDFT',trf:'TRF-1',trt:'TRT-10',cidades:['Bras√≠lia','Ceil√¢ndia','Taguatinga','Samambaia','Planaltina']},
    {uf:'ES',nome:'Esp√≠rito Santo',tj:'TJES',trf:'TRF-2',trt:'TRT-17',cidades:['Vit√≥ria','Serra','Vila Velha','Cariacica','Cachoeiro de Itapemirim']},
    {uf:'GO',nome:'Goi√°s',tj:'TJGO',trf:'TRF-1',trt:'TRT-18',cidades:['Goi√¢nia','Aparecida de Goi√¢nia','An√°polis','Rio Verde','Luzi√¢nia']},
    {uf:'MA',nome:'Maranh√£o',tj:'TJMA',trf:'TRF-1',trt:'TRT-16',cidades:['S√£o Lu√≠s','Imperatriz','Timon','Caxias','Cod√≥']},
    {uf:'MT',nome:'Mato Grosso',tj:'TJMT',trf:'TRF-1',trt:'TRT-23',cidades:['Cuiab√°','V√°rzea Grande','Rondon√≥polis','Sinop','Tangar√° da Serra']},
    {uf:'MS',nome:'Mato Grosso do Sul',tj:'TJMS',trf:'TRF-3',trt:'TRT-24',cidades:['Campo Grande','Dourados','Tr√™s Lagoas','Corumb√°','Grande Dourados']},
    {uf:'MG',nome:'Minas Gerais',tj:'TJMG',trf:'TRF-1',trt:'TRT-3',cidades:['Belo Horizonte','Uberl√¢ndia','Contagem','Juiz de Fora','Betim']},
    {uf:'PA',nome:'Par√°',tj:'TJPA',trf:'TRF-1',trt:'TRT-8',cidades:['Bel√©m','Ananindeua','Santar√©m','Marab√°','Parauapebas']},
    {uf:'PB',nome:'Para√≠ba',tj:'TJPB',trf:'TRF-5',trt:'TRT-13',cidades:['Jo√£o Pessoa','Campina Grande','Santa Rita','Patos','Bayeux']},
    {uf:'PR',nome:'Paran√°',tj:'TJPR',trf:'TRF-4',trt:'TRT-9',cidades:['Curitiba','Londrina','Maring√°','Ponta Grossa','Cascavel','S√£o Jos√© dos Pinhais','Foz do Igua√ßu','Colombo','Guarapuava','Paranagu√°']},
    {uf:'PE',nome:'Pernambuco',tj:'TJPE',trf:'TRF-5',trt:'TRT-6',cidades:['Recife','Caruaru','Olinda','Petrolina','Garanhuns']},
    {uf:'PI',nome:'Piau√≠',tj:'TJPI',trf:'TRF-1',trt:'TRT-22',cidades:['Teresina','Parna√≠ba','Picos','Floriano','Campo Maior']},
    {uf:'RJ',nome:'Rio de Janeiro',tj:'TJRJ',trf:'TRF-2',trt:'TRT-1',cidades:['Rio de Janeiro','S√£o Gon√ßalo','Duque de Caxias','Nova Igua√ßu','Niter√≥i']},
    {uf:'RN',nome:'Rio Grande do Norte',tj:'TJRN',trf:'TRF-5',trt:'TRT-21',cidades:['Natal','Mossor√≥','Parnamirim','S√£o Gon√ßalo do Amarante']},
    {uf:'RS',nome:'Rio Grande do Sul',tj:'TJRS',trf:'TRF-4',trt:'TRT-4',cidades:['Porto Alegre','Caxias do Sul','Canoas','Pelotas','Santa Maria']},
    {uf:'RO',nome:'Rond√¥nia',tj:'TJRO',trf:'TRF-1',trt:'TRT-14',cidades:['Porto Velho','Ji-Paran√°','Ariquemes','Cacoal','Vilhena']},
    {uf:'RR',nome:'Roraima',tj:'TJRR',trf:'TRF-1',trt:'TRT-11',cidades:['Boa Vista','Rorain√≥polis','Caracara√≠']},
    {uf:'SC',nome:'Santa Catarina',tj:'TJSC',trf:'TRF-4',trt:'TRT-12',cidades:['Florian√≥polis','Joinville','Blumenau','S√£o Jos√©','Crici√∫ma']},
    {uf:'SP',nome:'S√£o Paulo',tj:'TJSP',trf:'TRF-3',trt:'TRT-2',cidades:['S√£o Paulo','Guarulhos','Campinas','S√£o Bernardo do Campo','Santo Andr√©']},
    {uf:'SE',nome:'Sergipe',tj:'TJSE',trf:'TRF-5',trt:'TRT-20',cidades:['Aracaju','Nossa Senhora do Socorro','Lagarto','Itabaiana']},
    {uf:'TO',nome:'Tocantins',tj:'TJTO',trf:'TRF-1',trt:'TRT-10',cidades:['Palmas','Aragua√≠na','Gurupi','Porto Nacional']},
  ]
};

// ======================================================
// CERTID√ïES ‚Äî 15 cards em 4 categorias
// ======================================================
const CERTIDOES = [
  { id:1, cat:'vendedor', catLabel:'Vendedor', num:'01', nome:'CND Receita Federal PF', url:'https://solucoes.receita.fazenda.gov.br/Servicos/certidaoInternet/PF/Emitir', desc:'Certid√£o Negativa de D√©bitos ‚Äî Pessoa F√≠sica', copyField:'cpf-vendedor' },
  { id:2, cat:'vendedor', catLabel:'Vendedor', num:'02', nome:'Justi√ßa Federal CJF', url:'https://www.cjf.jus.br/cjf/certidao-negativa/', desc:'Certid√£o de A√ß√µes C√≠veis e Criminais', copyField:'cpf-vendedor' },
  { id:3, cat:'vendedor', catLabel:'Vendedor', num:'03', nome:'TJPR 2¬∫ Grau', url:'https://portal.tjpr.jus.br/jurisprudencia/certidao/formulario.do', desc:'Certid√£o de Jurisprud√™ncia ‚Äî 2¬∫ Grau', copyField:'cpf-vendedor' },
  { id:4, cat:'vendedor', catLabel:'Vendedor', num:'04', nome:'CNDT TST', url:'https://cndt-certidao.tst.jus.br/inicio.faces', desc:'Certid√£o Negativa de D√©bitos Trabalhistas', copyField:'cpf-vendedor' },
  { id:5, cat:'vendedor', catLabel:'Vendedor', num:'05', nome:'Protesto Nacional', url:'https://www.protestonacional.com.br/', desc:'Consulta Nacional de Protestos', copyField:'cpf-vendedor' },
  { id:6, cat:'vendedor', catLabel:'Vendedor', num:'06', nome:'TRT-9 Paran√°', url:'https://pje.trt9.jus.br/certidoes/', desc:'Certid√£o Trabalhista ‚Äî TRT 9¬™ Regi√£o', copyField:'cpf-vendedor' },
  { id:7, cat:'vendedor', catLabel:'Vendedor', num:'07', nome:'Quita√ß√£o Eleitoral TSE', url:'https://www.tse.jus.br/servicos-eleitorais/certidoes/certidao-de-quitacao-eleitoral', desc:'Certid√£o de Quita√ß√£o Eleitoral', copyField:'cpf-vendedor' },
  { id:8, cat:'imovel', catLabel:'Im√≥vel', num:'08', nome:'Matr√≠cula RI Digital', url:'https://www.registrodeimoveis.org.br/', desc:'Certid√£o de Matr√≠cula ‚Äî Registro de Im√≥veis', copyField:null },
  { id:9, cat:'imovel', catLabel:'Im√≥vel', num:'09', nome:'√înus Reais', url:'https://www.registrodeimoveis.org.br/', desc:'Certid√£o de √înus Reais e A√ß√µes Reipersecut√≥rias', copyField:null },
  { id:10, cat:'imovel', catLabel:'Im√≥vel', num:'10', nome:'IPTU Curitiba', url:'https://iptu.curitiba.pr.gov.br/', desc:'Certid√£o de IPTU ‚Äî Munic√≠pio de Curitiba', copyField:null },
  { id:11, cat:'imovel', catLabel:'Im√≥vel', num:'11', nome:'Valor Venal Curitiba', url:'https://iptu.curitiba.pr.gov.br/', desc:'Consulta de Valor Venal ‚Äî Curitiba', copyField:null },
  { id:12, cat:'comprador', catLabel:'Comprador', num:'12', nome:'CND Receita Federal', url:'https://solucoes.receita.fazenda.gov.br/Servicos/certidaoInternet/PF/Emitir', desc:'Certid√£o Negativa ‚Äî Pessoa F√≠sica do Comprador', copyField:'cpf-comprador' },
  { id:13, cat:'comprador', catLabel:'Comprador', num:'13', nome:'Justi√ßa Federal CJF', url:'https://www.cjf.jus.br/cjf/certidao-negativa/', desc:'Certid√£o de A√ß√µes ‚Äî Comprador', copyField:'cpf-comprador' },
  { id:14, cat:'complementar', catLabel:'Complementar', num:'14', nome:'Registro Civil', url:'https://registrocivil.org.br/', desc:'Certid√£o do Registro Civil Nacional', copyField:null },
  { id:15, cat:'complementar', catLabel:'Complementar', num:'15', nome:'Pesquisa de Bens CNIB', url:'https://www.cnib.org.br/', desc:'Central Nacional de Indisponibilidade de Bens', copyField:null },
];

const CATEGORIAS = [
  { key:'vendedor', label:'Vendedor', icon:'üè∑Ô∏è', badgeClass:'vendedor' },
  { key:'imovel', label:'Im√≥vel', icon:'üè†', badgeClass:'imovel' },
  { key:'comprador', label:'Comprador', icon:'üë§', badgeClass:'comprador' },
  { key:'complementar', label:'Complementares', icon:'üìé', badgeClass:'complementar' },
];

// ======================================================
// STATE
// ======================================================
let openedCards = new Set();
let vendedores = [];
let currentUser = null;

// ======================================================
// INIT
// ======================================================
window.addEventListener('load', () => {
  // Populate estados
  const sel = document.getElementById('sel-estado');
  CERT_DB.estados.sort((a,b) => a.nome.localeCompare(b.nome)).forEach(e => {
    sel.innerHTML += `<option value="${e.uf}">${e.nome} (${e.uf})</option>`;
  });
  // Paran√° default
  sel.value = 'PR';
  updateCidade();

  // Build cards
  buildCards();

  // CPF masks
  document.getElementById('inp-comprador-cpf').addEventListener('input', function(){ maskCPF(this); });
  document.getElementById('inp-comprador-nome').addEventListener('input', updateTransacaoLabel);
  document.getElementById('sel-estado').addEventListener('change', updateTransacaoLabel);
  document.getElementById('sel-cidade').addEventListener('change', updateTransacaoLabel);

  // Firebase Auth listener
  window.addEventListener('userLoggedIn', (e) => {
    currentUser = e.detail;
    handleLogin();
  });
  window.addEventListener('userLoggedOut', () => {
    currentUser = null;
    showScreen('welcome');
  });

  // Hide loader after 1.2s
  setTimeout(() => {
    const loader = document.getElementById('global-loader');
    loader.style.opacity = '0';
    setTimeout(() => loader.style.display = 'none', 400);
  }, 1200);
});

// ======================================================
// AUTH
// ======================================================
document.getElementById('btn-login-google').addEventListener('click', async () => {
  try {
    if (!window._fbAuth) {
      showToast('‚ö†Ô∏è Configure o Firebase antes de usar o login.', 5000);
      return;
    }
    await window._fbSignInWithPopup(window._fbAuth, window._fbProvider);
  } catch(err) {
    console.error(err);
    showToast('Erro no login: ' + (err.message || 'Tente novamente'), 4000);
  }
});

function handleLogin() {
  const alreadyRegistered = localStorage.getItem('dv_registered_' + currentUser.uid);
  if (!alreadyRegistered) {
    // Show register modal
    document.getElementById('reg-email').value = currentUser.email || '';
    document.getElementById('reg-nome').value = currentUser.displayName || '';
    document.getElementById('screen-register').classList.add('active');
  } else {
    showAppScreen();
  }
}

async function submitRegister() {
  const nome = document.getElementById('reg-nome').value.trim();
  const cpf = document.getElementById('reg-cpf').value.trim();
  const cnpj = document.getElementById('reg-cnpj').value.trim();
  const instagram = document.getElementById('reg-instagram').value.trim();
  const email = document.getElementById('reg-email').value.trim();

  if (!nome || !cpf) { showToast('‚ö†Ô∏è Nome e CPF s√£o obrigat√≥rios.'); return; }

  const data = { nome, cpf, cnpj, instagram, email, data: new Date().toISOString() };

  // Save locally
  localStorage.setItem('dv_registered_' + currentUser.uid, JSON.stringify(data));

  // Send to Google Sheets (placeholder)
  try {
    // =====================================================
    // SUBSTITUA COM A URL DO SEU GOOGLE APPS SCRIPT
    // =====================================================
    await fetch('https://script.google.com/macros/s/SEU_SCRIPT_ID/exec', {
      method: 'POST',
      mode: 'no-cors',
      body: JSON.stringify(data)
    });
  } catch(e) { console.warn('Webhook error (ignorado):', e); }

  document.getElementById('screen-register').classList.remove('active');
  showAppScreen();
  showToast('‚úÖ Cadastro realizado com sucesso!');
}

function showAppScreen() {
  if (currentUser) {
    document.getElementById('header-avatar').src = currentUser.photoURL || '';
    document.getElementById('header-name').textContent = currentUser.displayName?.split(' ')[0] || '';
    document.getElementById('app-header').style.display = 'block';
    document.getElementById('app-footer').classList.add('show');
  }
  showScreen('app');
}

async function doLogout() {
  try {
    await window._fbSignOut(window._fbAuth);
  } catch(e) {}
  document.getElementById('app-header').style.display = 'none';
  document.getElementById('app-footer').classList.remove('show');
  showScreen('welcome');
  showToast('üëã Voc√™ saiu com sucesso.');
}

// ======================================================
// SCREENS
// ======================================================
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  const el = document.getElementById('screen-' + id);
  if (el) el.classList.add('active');
}

// ======================================================
// ESTADO / CIDADE
// ======================================================
function updateCidade() {
  const uf = document.getElementById('sel-estado').value;
  const selC = document.getElementById('sel-cidade');
  selC.innerHTML = '<option value="">Selecione a cidade‚Ä¶</option>';
  if (!uf) return;
  const est = CERT_DB.estados.find(e => e.uf === uf);
  if (!est) return;
  est.cidades.forEach(c => {
    selC.innerHTML += `<option value="${c}">${c}</option>`;
  });
  // Default Curitiba if PR
  if (uf === 'PR') selC.value = 'Curitiba';
  updateTransacaoLabel();
}

function updateTransacaoLabel() {
  const compradorNome = document.getElementById('inp-comprador-nome').value;
  const cidade = document.getElementById('sel-cidade').value;
  const uf = document.getElementById('sel-estado').value;
  let label = '';
  if (cidade && uf) label += `${cidade}/${uf}`;
  if (compradorNome) label += (label ? ' ¬∑ Comprador: ' : 'Comprador: ') + compradorNome;
  document.getElementById('transacao-label').textContent = label || 'Configure os dados na barra lateral para personalizar';
}

// ======================================================
// VENDEDORES
// ======================================================
function showVendedorForm() {
  document.getElementById('vendedor-form-inline').style.display = 'block';
  document.getElementById('btn-show-vf').style.display = 'none';
  document.getElementById('vf-nome').focus();
}
function hideVendedorForm() {
  document.getElementById('vendedor-form-inline').style.display = 'none';
  document.getElementById('btn-show-vf').style.display = 'flex';
  document.getElementById('vf-nome').value = '';
  document.getElementById('vf-cpf').value = '';
}
function confirmAddVendedor() {
  const nome = document.getElementById('vf-nome').value.trim();
  const cpf = document.getElementById('vf-cpf').value.trim();
  if (!nome) { showToast('‚ö†Ô∏è Informe o nome do vendedor.'); return; }
  vendedores.push({ id: Date.now(), nome, cpf });
  renderVendedores();
  hideVendedorForm();
  showToast(`‚úÖ Vendedor "${nome}" adicionado`);
}
function removeVendedor(id) {
  vendedores = vendedores.filter(v => v.id !== id);
  renderVendedores();
}
function renderVendedores() {
  const list = document.getElementById('vendedores-list');
  if (vendedores.length === 0) {
    list.innerHTML = '';
    return;
  }
  list.innerHTML = vendedores.map(v => `
    <div class="vendedor-item">
      <div class="vi-name">${v.nome}</div>
      <div class="vi-cpf">${v.cpf || '‚Äî'}</div>
      <button class="vi-remove" onclick="removeVendedor(${v.id})" title="Remover">‚úï</button>
    </div>
  `).join('');
}

// ======================================================
// BUILD CARDS
// ======================================================
function buildCards() {
  const container = document.getElementById('cards-container');
  let html = '';
  CATEGORIAS.forEach(cat => {
    const cards = CERTIDOES.filter(c => c.cat === cat.key);
    html += `
      <div class="cat-section">
        <div class="cat-header">
          <div class="cat-badge ${cat.badgeClass}">${cat.icon} ${cat.label}</div>
          <span class="cat-count">${cards.length} certid√£o${cards.length > 1 ? '√µes' : ''}</span>
        </div>
        <div class="cards-grid">
          ${cards.map(c => buildCard(c, cat.key)).join('')}
        </div>
      </div>
    `;
  });
  container.innerHTML = html;
}

function buildCard(cert, catKey) {
  const domain = new URL(cert.url).hostname.replace('www.','');
  return `
    <div class="cert-card cat-${catKey}" id="card-${cert.id}">
      <div class="card-stripe"></div>
      <div class="card-body">
        <div class="card-num">Certid√£o ${cert.num}</div>
        <div class="card-name">${cert.nome}</div>
        <div class="card-url" title="${cert.url}">${domain}</div>
      </div>
      <div class="card-footer">
        <button class="btn-open" onclick="openCert(${cert.id})">
          üîó Abrir Site
        </button>
        <button class="btn-mark" id="btn-mark-${cert.id}" onclick="toggleMark(${cert.id})">
          ‚úì OK
        </button>
      </div>
    </div>
  `;
}

// ======================================================
// OPEN CERT
// ======================================================
function openCert(id) {
  const cert = CERTIDOES.find(c => c.id === id);
  if (!cert) return;

  // Determine CPF to copy
  let cpfToCopy = '';
  if (cert.copyField === 'cpf-vendedor') {
    // Use first vendedor CPF, or prompt
    cpfToCopy = vendedores.length > 0 ? vendedores[0].cpf : '';
  } else if (cert.copyField === 'cpf-comprador') {
    cpfToCopy = document.getElementById('inp-comprador-cpf').value;
  }

  if (cpfToCopy) {
    navigator.clipboard.writeText(cpfToCopy).then(() => {
      showToast(`üìã CPF copiado: ${cpfToCopy}`);
    }).catch(() => {
      showToast(`üìã CPF: ${cpfToCopy} (copie manualmente)`);
    });
  }

  window.open(cert.url, '_blank', 'noopener,noreferrer');

  // Auto-mark as opened
  if (!openedCards.has(id)) {
    openedCards.add(id);
    updateCardUI(id, true);
    updateProgress();
  }
}

function toggleMark(id) {
  if (openedCards.has(id)) {
    openedCards.delete(id);
    updateCardUI(id, false);
  } else {
    openedCards.add(id);
    updateCardUI(id, true);
  }
  updateProgress();
}

function updateCardUI(id, opened) {
  const card = document.getElementById('card-' + id);
  if (!card) return;
  if (opened) {
    card.classList.add('opened');
    card.querySelector('.btn-mark').textContent = '‚úì Feita';
    // Add badge
    if (!card.querySelector('.opened-badge')) {
      const badge = document.createElement('div');
      badge.className = 'opened-badge';
      badge.textContent = 'Aberta';
      card.appendChild(badge);
    }
  } else {
    card.classList.remove('opened');
    card.querySelector('.btn-mark').textContent = '‚úì OK';
    const badge = card.querySelector('.opened-badge');
    if (badge) badge.remove();
  }
}

function updateProgress() {
  const total = CERTIDOES.length;
  const opened = openedCards.size;
  const pending = total - opened;
  document.getElementById('cnt-total').textContent = total;
  document.getElementById('cnt-opened').textContent = opened;
  document.getElementById('cnt-pending').textContent = pending;
  document.getElementById('progress-fill').style.width = (opened / total * 100) + '%';
}

// ======================================================
// MASKS
// ======================================================
function maskCPF(input) {
  let v = input.value.replace(/\D/g, '').slice(0,11);
  if (v.length > 9) v = v.replace(/(\d{3})(\d{3})(\d{3})(\d{0,2})/, '$1.$2.$3-$4');
  else if (v.length > 6) v = v.replace(/(\d{3})(\d{3})(\d{0,3})/, '$1.$2.$3');
  else if (v.length > 3) v = v.replace(/(\d{3})(\d{0,3})/, '$1.$2');
  input.value = v;
}

document.getElementById('reg-cpf').addEventListener('input', function(){ maskCPF(this); });
document.getElementById('reg-cnpj').addEventListener('input', function(){
  let v = this.value.replace(/\D/g,'').slice(0,14);
  if (v.length > 12) v = v.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{0,2})/,'$1.$2.$3/$4-$5');
  else if (v.length > 8) v = v.replace(/(\d{2})(\d{3})(\d{3})(\d{0,4})/,'$1.$2.$3/$4');
  else if (v.length > 5) v = v.replace(/(\d{2})(\d{3})(\d{0,3})/,'$1.$2.$3');
  else if (v.length > 2) v = v.replace(/(\d{2})(\d{0,3})/,'$1.$2');
  this.value = v;
});

// ======================================================
// TOAST
// ======================================================
function showToast(msg, duration = 3000) {
  const container = document.getElementById('toast-container');
  const el = document.createElement('div');
  el.className = 'toast';
  el.innerHTML = `<span>${msg}</span>`;
  container.appendChild(el);
  setTimeout(() => {
    el.classList.add('fade-out');
    setTimeout(() => el.remove(), 300);
  }, duration);
}

// ======================================================
// DOWNLOAD REPORT
// ======================================================
function downloadReport() {
  const compradorNome = document.getElementById('inp-comprador-nome').value || '‚Äî';
  const compradorCPF = document.getElementById('inp-comprador-cpf').value || '‚Äî';
  const estado = document.getElementById('sel-estado').options[document.getElementById('sel-estado').selectedIndex]?.text || '‚Äî';
  const cidade = document.getElementById('sel-cidade').value || '‚Äî';
  const now = new Date().toLocaleString('pt-BR');
  const total = CERTIDOES.length;
  const opened = openedCards.size;
  const pending = total - opened;

  const vendedoresRows = vendedores.length > 0
    ? vendedores.map(v => `<tr><td>${v.nome}</td><td>${v.cpf || '‚Äî'}</td></tr>`).join('')
    : '<tr><td colspan="2" style="color:#999;font-style:italic;">Nenhum vendedor cadastrado</td></tr>';

  const certsRows = CERTIDOES.map(c => {
    const done = openedCards.has(c.id);
    return `
      <tr>
        <td>${c.num}</td>
        <td>${c.catLabel}</td>
        <td>${c.nome}</td>
        <td style="color:${done ? '#2e7d32' : '#c0392b'};font-weight:600;">${done ? '‚úì Conclu√≠da' : '‚úó Pendente'}</td>
      </tr>
    `;
  }).join('');

  const html = `<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Relat√≥rio de Certid√µes ‚Äî Douglas Vilar</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=DM+Sans:wght@300;400;500&display=swap');
  body { font-family: 'DM Sans', sans-serif; color: #1a1512; margin: 0; padding: 40px; background: #fff; }
  .header { background: #0b3b5c; color: white; padding: 32px 40px; border-radius: 12px 12px 0 0; display: flex; align-items: center; justify-content: space-between; }
  .header-left h1 { font-family: 'Playfair Display', serif; font-size: 1.6rem; margin: 0 0 4px; }
  .header-left p { font-size: 0.78rem; color: rgba(255,255,255,0.6); letter-spacing: 1px; margin: 0; }
  .header-right { text-align: right; font-size: 0.75rem; color: rgba(255,255,255,0.5); }
  .gold { color: #c4a54d; }
  .body { border: 2px solid #0b3b5c; border-top: none; border-radius: 0 0 12px 12px; padding: 32px 40px; }
  .section-title { font-family: 'Playfair Display', serif; color: #0b3b5c; font-size: 1.1rem; border-bottom: 2px solid #c4a54d; padding-bottom: 8px; margin: 24px 0 14px; }
  table { width: 100%; border-collapse: collapse; margin-bottom: 8px; }
  th { background: #0b3b5c; color: white; padding: 10px 14px; text-align: left; font-size: 0.8rem; font-weight: 500; }
  td { padding: 9px 14px; border-bottom: 1px solid #eee; font-size: 0.85rem; }
  tr:hover td { background: #f9f7f3; }
  .stats { display: grid; grid-template-columns: repeat(3,1fr); gap: 16px; margin: 20px 0; }
  .stat { background: #f9f7f3; border-radius: 10px; padding: 16px; text-align: center; border-left: 4px solid #0b3b5c; }
  .stat .n { font-family: 'Playfair Display', serif; font-size: 2rem; font-weight: 700; color: #0b3b5c; }
  .stat .l { font-size: 0.72rem; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-top: 4px; }
  .footer-doc { margin-top: 32px; padding-top: 16px; border-top: 1px solid #eee; font-size: 0.72rem; color: #aaa; text-align: center; }
  @media print { body { padding: 20px; } }
</style>
</head>
<body>
<div class="header">
  <div class="header-left">
    <h1>Douglas Vilar <span class="gold">|</span> ADVOCACIA</h1>
    <p>OAB/PR 47.278 &nbsp;¬∑&nbsp; Relat√≥rio de Certid√µes Imobili√°rias</p>
  </div>
  <div class="header-right">
    <div style="font-size:0.9rem;color:rgba(255,255,255,0.8)">${now}</div>
    <div>douglasvilar.com.br</div>
  </div>
</div>
<div class="body">
  <div class="section-title">üìç Dados da Transa√ß√£o</div>
  <table>
    <tr><th>Campo</th><th>Valor</th></tr>
    <tr><td>Localidade</td><td>${cidade} / ${estado}</td></tr>
    <tr><td>Comprador</td><td>${compradorNome}</td></tr>
    <tr><td>CPF do Comprador</td><td>${compradorCPF}</td></tr>
  </table>

  <div class="section-title">üè∑Ô∏è Vendedores</div>
  <table>
    <tr><th>Nome</th><th>CPF</th></tr>
    ${vendedoresRows}
  </table>

  <div class="section-title">üìä Resumo de Progresso</div>
  <div class="stats">
    <div class="stat"><div class="n">${total}</div><div class="l">Total</div></div>
    <div class="stat" style="border-left-color:#2e7d32"><div class="n" style="color:#2e7d32">${opened}</div><div class="l">Conclu√≠das</div></div>
    <div class="stat" style="border-left-color:#e65100"><div class="n" style="color:#e65100">${pending}</div><div class="l">Pendentes</div></div>
  </div>

  <div class="section-title">üìã Certid√µes Detalhadas</div>
  <table>
    <tr><th>#</th><th>Categoria</th><th>Certid√£o</th><th>Status</th></tr>
    ${certsRows}
  </table>

  <div class="footer-doc">
    Documento gerado automaticamente pela plataforma Gerador de Certid√µes Imobili√°rias &nbsp;¬∑&nbsp;
    Douglas Vilar Sociedade de Advogados &nbsp;¬∑&nbsp; OAB/PR 47.278 &nbsp;¬∑&nbsp; ${now}
  </div>
</div>
</body>
</html>`;

  const blob = new Blob([html], { type: 'text/html' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `Relatorio_Certidoes_${new Date().toISOString().slice(0,10)}.html`;
  a.click();
  URL.revokeObjectURL(url);
  showToast('üì• Relat√≥rio gerado com sucesso!');
}
</script>
</body>
</html>
`;
